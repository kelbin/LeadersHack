# DTLHack2021Backend

## Backend Интерактивной карты для размещения спортивной инфраструктуры.

Инструкция по запуску.

1. Склонировать репозиторий. В папке utils/excel_parser расположить excel-файл, расположенный по ссылке:
```
https://docs.google.com/spreadsheets/d/1N7g5uZhYwrcxIMebDYnUpe8SfFUZPigF/edit?usp=sharing&ouid=109004736220186011475&rtpof=true&sd=true
```
2. Если репозиторий склонирован на сервер, перейти к п.6
3. Если репозиторий склонирован на локальную машину - один из способов получить доступный из вне url - воспользоваться утилитой ngrok, прокинув 8080 порт
4. Скачать ngrok если не установлен.
5. Запустить ngrok командой: 
```
ngrok http 8080
```
6. Установить (если отсутствует) и запустить базу данных MongoDB
7. Перейти в корневую папку проекта и запустить сервер командой:
```
python main.py
```
8. Отправить пустой GET запрос на url-адрес /generateData для заполнения базы данных данными из файла п.1

### ROUTES:

### 1) .../get/sportpoints

  ```
  GET /get/sportpoints?minLat&minLong&maxLat&maxLong
  ```
  
Возвращает все спортивные объекты внутри прямоугольного полигона. В запросе через параметры передаются координаты верхней левой и правой нижней точек полигона.

### Response Body
  ```
  {
    "sport_points": [
        {
            "_id": "61718d1832ee9f470fbb49cb",
            "name": "Спортивный комплекс высшего учебного заведения «Московский автомобильно-дорожный государственный технический университет»",
            "category": null,
            "size": 497.0,
            "location": {
                "latitude": 55.80248047413373,
                "longitude": 37.5292134118028,
                "fullAdressString": "Ленинградский проспект, дом 64"
            },
            "owner": "Минобрнауки России",
            "phone": null,
            "sports": [
                "Бадминтон",
                "Баскетбол",
                "Бокс",
                "Волейбол",
                ...
            ],
            "rating": "Окружное"
        },
        {
            "_id": "61718d1832ee9f470fbb49e1",
            "name": "Дворец спортивных единоборств ЦСКА",
            "category": null,
            "size": 237.6,
            "location": {
                "latitude": 55.793708,
                "longitude": 37.536832,
                "fullAdressString": "Ленинградский проспект, дом 39, строение 27"
            },
            "owner": "Министерство обороны Российской Федерации",
            "phone": null,
            "sports": [
                "Спортивная борьба",
                "Бокс",
                "Фехтование",
                "Спортивная борьба",
                ...
            ],
            "rating": "Районное"
        },
        ...
    ]
  }
  ```
### 2) .../geoZones
  ```
  GET, POST /geoZones
  ```
  Позволяет добавить гео-зону, или же получить список всех имеющихся гео-зон. 
  
  POST
  
### Request Bode
  ```
  {
    "name": "Щукино",
    "minLocation": {
        "latitude": 55.812778,
        "longitude": 37.449667
    },
    "maxLocation": {
        "latitude": 55.789838,
        "longitude": 37.502025
    },
    "population": 109684
}
  ```
GET

### Response Body
  ```
  {
    "geo_zones": [
        "geo_zones": [
        {
            "_id": "61741b8d4071b677af6ebb3b",
            "name": "Южное Тушино",
            "minLocation": {
                "latitude": 55.862222,
                "longitude": 37.410472
            },
            "maxLocation": {
                "latitude": 55.849528,
                "longitude": 37.456417
            },
            "population": 109684,
            "sport_points_count": 12,
            "sport_points_size": 2907.8,
            "sports_count": 99
        },
        {
            "_id": "61741b8d4071b677af6ebb3a",
            "name": "Щукино",
            "minLocation": {
                "latitude": 55.812778,
                "longitude": 37.449667
            },
            "maxLocation": {
                "latitude": 55.789838,
                "longitude": 37.502025
            },
            "population": 111207,
            "sport_points_count": 12,
            "sport_points_size": 5537.9,
            "sports_count": 40
        },
        ...
    ]
}
  ```
### 3) .../prediction
  ```
  GET /prediction
  ```
  В теле запроса передаются координаты места на карте и параметры по предсказанию, такие как: тип спортзоны, доступность и виды спорта. В ответ модель возвращает предсказание по необходимой площади застройки при строительстве спортивного объекта с указанными параметрами.
  
  GET 
### Request Body 
  
  ```
  {
    "Тип спортзоны": ["универсальная спортивная площадка"],
    "Доступность": ["Шаговая доступность"],
    "Вид спорта": ["Футбол, Катание на лыжах, Баскетбол"],
    "Широта": [55.741227],
    "Долгота": [37.705778]
}
  
  ```
  ### Response Body
  ```
  {
    "prediction": "3149.9323421008885"
}
  ```
  
